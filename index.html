<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>MyEqApp</title>
    
    <link rel="manifest" id="my-manifest" href="manifest.json">
    
    <meta name="theme-color" content="#121212">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="./icon-192.png">

    <style>
        body { font-family: 'Segoe UI', sans-serif; background-color: #121212; color: white; margin: 0; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; }
        .player-container { width: 100%; max-width: 400px; background: #1e1e1e; padding: 20px; border-radius: 20px; text-align: center; margin-top: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        h1 { color: #bb86fc; margin-bottom: 20px; }
        #startBtn { background-color: #bb86fc; color: black; font-weight: bold; padding: 15px; width: 100%; border: none; border-radius: 12px; cursor: pointer; }
        .hidden { display: none !important; }
        .status-light { width: 12px; height: 12px; border-radius: 50%; background: red; display: inline-block; margin-left: 10px; }
        .status-light.green { background: #00ff00; box-shadow: 0 0 10px #00ff00; }
    </style>
</head>
<body>

    <div class="player-container">
        <h1>üéöÔ∏è MyEqApp <div id="statusLight" class="status-light"></div></h1>
        <button id="startBtn" onclick="initAudioEngine()">ACTIVATE ENGINE</button>
        <div id="controlsArea" class="hidden">
            <p>Engine Active & Local Store Ready</p>
            <audio id="audioPlayer" controls></audio>
        </div>
    </div>

    <script>
        // FORCING MANIFEST RE-DETECTION
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const manifest = document.getElementById('my-manifest');
                manifest.setAttribute('href', 'manifest.json?v=' + Date.now()); // Appends timestamp

                navigator.serviceWorker.register('./sw.js').then(reg => {
                    console.log("MyEqApp v9.2 SW Registered");
                });
            });
        }

        function initAudioEngine() {
            document.getElementById('startBtn').classList.add('hidden');
            document.getElementById('controlsArea').classList.remove('hidden');
            document.getElementById('statusLight').classList.add('green');
        }

        // MIME VALIDATOR: This tells you exactly what the server is sending
        async function validateIconType() {
            try {
                const res = await fetch('./icon-192.png');
                const contentType = res.headers.get('content-type');
                console.log(`SERVER CHECK: icon-192.png is being sent as: ${contentType}`);
                if (contentType.includes('jpeg')) {
                    console.error("ERROR: The server still thinks this is a JPEG. Try clearing your browser cache (F12 > Application > Clear Site Data).");
                } else {
                    console.log("SUCCESS: Icon is a valid PNG.");
                }
            } catch (e) { console.warn("Could not reach icon file."); }
        }
        validateIconType();
    </script>
</body>
</html>